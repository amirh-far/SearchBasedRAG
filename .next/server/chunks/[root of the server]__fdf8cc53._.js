module.exports = {

"[project]/.next-internal/server/app/api/chat/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[project]/lib/utils/registry.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getModel": (()=>getModel),
    "getToolCallModel": (()=>getToolCallModel),
    "isProviderEnabled": (()=>isProviderEnabled),
    "isReasoningModel": (()=>isReasoningModel),
    "isToolCallSupported": (()=>isToolCallSupported),
    "registry": (()=>registry)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$anthropic$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/anthropic/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$azure$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/azure/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$deepseek$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/deepseek/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$fireworks$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/fireworks/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$google$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/google/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$groq$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/groq/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$openai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/openai/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$xai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@ai-sdk/xai/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ollama$2d$ai$2d$provider$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/ollama-ai-provider/dist/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
const registry = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["experimental_createProviderRegistry"])({
    openai: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$openai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["openai"],
    anthropic: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$anthropic$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["anthropic"],
    google: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$google$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["google"],
    groq: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$groq$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["groq"],
    ollama: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ollama$2d$ai$2d$provider$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOllama"])({
        baseURL: `${process.env.OLLAMA_BASE_URL}/api`
    }),
    azure: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$azure$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAzure"])({
        apiKey: process.env.AZURE_API_KEY,
        resourceName: process.env.AZURE_RESOURCE_NAME
    }),
    deepseek: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$deepseek$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deepseek"],
    fireworks: {
        ...(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$fireworks$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createFireworks"])({
            apiKey: process.env.FIREWORKS_API_KEY
        }),
        languageModel: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$fireworks$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fireworks"]
    },
    'openai-compatible': (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$openai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOpenAI"])({
        apiKey: process.env.OPENAI_COMPATIBLE_API_KEY,
        baseURL: process.env.OPENAI_COMPATIBLE_API_BASE_URL
    }),
    xai: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$xai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["xai"]
});
function getModel(model) {
    const [provider, ...modelNameParts] = model.split(':') ?? [];
    const modelName = modelNameParts.join(':');
    if (model.includes('ollama')) {
        const ollama = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ollama$2d$ai$2d$provider$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOllama"])({
            baseURL: `${process.env.OLLAMA_BASE_URL}/api`
        });
        // if model is deepseek-r1, add reasoning middleware
        if (model.includes('deepseek-r1')) {
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["wrapLanguageModel"])({
                model: ollama(modelName),
                middleware: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["extractReasoningMiddleware"])({
                    tagName: 'think'
                })
            });
        }
        // if ollama provider, set simulateStreaming to true
        return ollama(modelName, {
            simulateStreaming: true
        });
    }
    // if model is groq and includes deepseek-r1, add reasoning middleware
    if (model.includes('groq') && model.includes('deepseek-r1')) {
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["wrapLanguageModel"])({
            model: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$groq$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["groq"])(modelName),
            middleware: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["extractReasoningMiddleware"])({
                tagName: 'think'
            })
        });
    }
    // if model is fireworks and includes deepseek-r1, add reasoning middleware
    if (model.includes('fireworks') && model.includes('deepseek-r1')) {
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["wrapLanguageModel"])({
            model: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$ai$2d$sdk$2f$fireworks$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fireworks"])(modelName),
            middleware: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["extractReasoningMiddleware"])({
                tagName: 'think'
            })
        });
    }
    return registry.languageModel(model);
}
function isProviderEnabled(providerId) {
    switch(providerId){
        case 'openai':
            return !!process.env.OPENAI_API_KEY;
        case 'anthropic':
            return !!process.env.ANTHROPIC_API_KEY;
        case 'google':
            return !!process.env.GOOGLE_GENERATIVE_AI_API_KEY;
        case 'groq':
            return !!process.env.GROQ_API_KEY;
        case 'ollama':
            return !!process.env.OLLAMA_BASE_URL;
        case 'azure':
            return !!process.env.AZURE_API_KEY && !!process.env.AZURE_RESOURCE_NAME;
        case 'deepseek':
            return !!process.env.DEEPSEEK_API_KEY;
        case 'fireworks':
            return !!process.env.FIREWORKS_API_KEY;
        case 'xai':
            return !!process.env.XAI_API_KEY;
        case 'openai-compatible':
            return !!process.env.OPENAI_COMPATIBLE_API_KEY && !!process.env.OPENAI_COMPATIBLE_API_BASE_URL;
        default:
            return false;
    }
}
function getToolCallModel(model) {
    const [provider, ...modelNameParts] = model?.split(':') ?? [];
    const modelName = modelNameParts.join(':');
    switch(provider){
        case 'deepseek':
            return getModel('deepseek:deepseek-chat');
        case 'fireworks':
            return getModel('fireworks:accounts/fireworks/models/llama-v3p1-8b-instruct');
        case 'groq':
            return getModel('groq:llama-3.1-8b-instant');
        case 'ollama':
            const ollamaModel = process.env.NEXT_PUBLIC_OLLAMA_TOOL_CALL_MODEL || modelName;
            return getModel(`ollama:${ollamaModel}`);
        case 'google':
            return getModel('google:gemini-2.0-flash');
        default:
            return getModel('openai:gpt-4o-mini');
    }
}
function isToolCallSupported(model) {
    const [provider, ...modelNameParts] = model?.split(':') ?? [];
    const modelName = modelNameParts.join(':');
    if (provider === 'ollama') {
        return false;
    }
    if (provider === 'google') {
        return false;
    }
    // Deepseek R1 is not supported
    // Deepseek v3's tool call is unstable, so we include it in the list
    return !modelName?.includes('deepseek');
}
function isReasoningModel(model) {
    if (typeof model !== 'string') {
        return false;
    }
    return model.includes('deepseek-r1') || model.includes('deepseek-reasoner') || model.includes('o3-mini');
}
}}),
"[project]/lib/agents/manual-researcher.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "manualResearcher": (()=>manualResearcher)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
;
;
const BASE_SYSTEM_PROMPT = `
Instructions:

You are a helpful AI assistant providing accurate information.

1. Provide comprehensive and detailed responses to user questions
2. Use markdown to structure your responses with appropriate headings
3. Acknowledge when you are uncertain about specific details
4. Focus on maintaining high accuracy in your responses
`;
const SEARCH_ENABLED_PROMPT = `
${BASE_SYSTEM_PROMPT}

When analyzing search results:
1. Analyze the provided search results carefully to answer the user's question
2. Always cite sources using the [number](url) format, matching the order of search results
3. If multiple sources are relevant, include all of them using comma-separated citations
4. Only use information that has a URL available for citation
5. If the search results don't contain relevant information, acknowledge this and provide a general response

Citation Format:
[number](url)
`;
const SEARCH_DISABLED_PROMPT = `
${BASE_SYSTEM_PROMPT}

Important:
1. Provide responses based on your general knowledge
2. Be clear about any limitations in your knowledge
3. Suggest when searching for additional information might be beneficial
`;
function manualResearcher({ messages, model, isSearchEnabled = true }) {
    try {
        const currentDate = new Date().toLocaleString();
        const systemPrompt = isSearchEnabled ? SEARCH_ENABLED_PROMPT : SEARCH_DISABLED_PROMPT;
        return {
            model: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getModel"])(model),
            system: `${systemPrompt}\nCurrent date and time: ${currentDate}`,
            messages,
            temperature: 0.6,
            topP: 1,
            topK: 40,
            experimental_transform: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["smoothStream"])({
                chunking: 'word'
            })
        };
    } catch (error) {
        console.error('Error in manualResearcher:', error);
        throw error;
    }
}
}}),
"[project]/lib/utils/context-window.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getMaxAllowedTokens": (()=>getMaxAllowedTokens),
    "truncateMessages": (()=>truncateMessages)
});
const DEFAULT_CONTEXT_WINDOW = 128_000;
const DEFAULT_RESERVE_TOKENS = 30_000;
function getMaxAllowedTokens(model) {
    let contextWindow;
    let reserveTokens;
    if (model.id.includes('deepseek')) {
        contextWindow = 64_000;
        reserveTokens = 27_000;
    } else if (model.id.includes('claude')) {
        contextWindow = 200_000;
        reserveTokens = 40_000;
    } else {
        contextWindow = DEFAULT_CONTEXT_WINDOW;
        reserveTokens = DEFAULT_RESERVE_TOKENS;
    }
    return contextWindow - reserveTokens;
}
function truncateMessages(messages, maxTokens) {
    let totalTokens = 0;
    const tempMessages = [];
    for(let i = messages.length - 1; i >= 0; i--){
        const message = messages[i];
        const messageTokens = message.content?.length || 0;
        if (totalTokens + messageTokens <= maxTokens) {
            tempMessages.push(message);
            totalTokens += messageTokens;
        } else {
            break;
        }
    }
    const orderedMessages = tempMessages.reverse();
    while(orderedMessages.length > 0 && orderedMessages[0].role !== 'user'){
        orderedMessages.shift();
    }
    return orderedMessages;
}
}}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/string_decoder [external] (string_decoder, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[project]/lib/redis/config.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "RedisWrapper": (()=>RedisWrapper),
    "closeRedisConnection": (()=>closeRedisConnection),
    "getRedisClient": (()=>getRedisClient),
    "redisConfig": (()=>redisConfig)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@upstash/redis/nodejs.mjs [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@upstash/redis/nodejs.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$redis$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/redis/dist/index.js [app-route] (ecmascript)");
;
;
const redisConfig = {
    useLocalRedis: process.env.USE_LOCAL_REDIS === 'true',
    upstashRedisRestUrl: process.env.UPSTASH_REDIS_REST_URL,
    upstashRedisRestToken: process.env.UPSTASH_REDIS_REST_TOKEN,
    localRedisUrl: process.env.LOCAL_REDIS_URL || 'redis://localhost:6379'
};
let localRedisClient = null;
let redisWrapper = null;
class RedisWrapper {
    client;
    constructor(client){
        this.client = client;
    }
    async zrange(key, start, stop, options) {
        let result;
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            result = await this.client.zrange(key, start, stop, options);
        } else {
            const redisClient = this.client;
            if (options?.rev) {
                result = await redisClient.zRange(key, start, stop, {
                    REV: true
                });
            } else {
                result = await redisClient.zRange(key, start, stop);
            }
        }
        return result;
    }
    async hgetall(key) {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            return this.client.hgetall(key);
        } else {
            const result = await this.client.hGetAll(key);
            return Object.keys(result).length > 0 ? result : null;
        }
    }
    pipeline() {
        return this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"] ? new UpstashPipelineWrapper(this.client.pipeline()) : new LocalPipelineWrapper(this.client.multi());
    }
    async hmset(key, value) {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            return this.client.hmset(key, value);
        } else {
            return this.client.hSet(key, value);
        }
    }
    async zadd(key, score, member) {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            return this.client.zadd(key, {
                score,
                member
            });
        } else {
            return this.client.zAdd(key, {
                score,
                value: member
            });
        }
    }
    async del(key) {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            return this.client.del(key);
        } else {
            return this.client.del(key);
        }
    }
    async zrem(key, member) {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            return this.client.zrem(key, member);
        } else {
            return this.client.zRem(key, member);
        }
    }
    async close() {
        if (this.client instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]) {
            // Upstash Redis doesn't require explicit closing
            return;
        } else {
            await this.client.quit();
        }
    }
}
// Wrapper class for Upstash Redis pipeline
class UpstashPipelineWrapper {
    pipeline;
    constructor(pipeline){
        this.pipeline = pipeline;
    }
    hgetall(key) {
        this.pipeline.hgetall(key);
        return this;
    }
    del(key) {
        this.pipeline.del(key);
        return this;
    }
    zrem(key, member) {
        this.pipeline.zrem(key, member);
        return this;
    }
    hmset(key, value) {
        this.pipeline.hmset(key, value);
        return this;
    }
    zadd(key, score, member) {
        this.pipeline.zadd(key, {
            score,
            member
        });
        return this;
    }
    async exec() {
        try {
            return await this.pipeline.exec();
        } catch (error) {
            throw error;
        }
    }
}
// Wrapper class for local Redis pipeline
class LocalPipelineWrapper {
    pipeline;
    constructor(pipeline){
        this.pipeline = pipeline;
    }
    hgetall(key) {
        this.pipeline.hGetAll(key);
        return this;
    }
    del(key) {
        this.pipeline.del(key);
        return this;
    }
    zrem(key, member) {
        this.pipeline.zRem(key, member);
        return this;
    }
    hmset(key, value) {
        // Convert all values to strings
        const stringValue = Object.fromEntries(Object.entries(value).map(([k, v])=>[
                k,
                String(v)
            ]));
        this.pipeline.hSet(key, stringValue);
        return this;
    }
    zadd(key, score, member) {
        this.pipeline.zAdd(key, {
            score,
            value: member
        });
        return this;
    }
    async exec() {
        try {
            return await this.pipeline.exec();
        } catch (error) {
            throw error;
        }
    }
}
async function getRedisClient() {
    if (redisWrapper) {
        return redisWrapper;
    }
    if (redisConfig.useLocalRedis) {
        if (!localRedisClient) {
            const localRedisUrl = redisConfig.localRedisUrl || 'redis://localhost:6379';
            try {
                localRedisClient = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$redis$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createClient"])({
                    url: localRedisUrl
                });
                await localRedisClient.connect();
            } catch (error) {
                if (error instanceof Error) {
                    if (error.message.includes('ECONNREFUSED')) {
                        console.error(`Failed to connect to local Redis at ${localRedisUrl}: Connection refused. Is Redis running?`);
                    } else if (error.message.includes('ETIMEDOUT')) {
                        console.error(`Failed to connect to local Redis at ${localRedisUrl}: Connection timed out. Check your network or Redis server.`);
                    } else if (error.message.includes('ENOTFOUND')) {
                        console.error(`Failed to connect to local Redis at ${localRedisUrl}: Host not found. Check your Redis URL.`);
                    } else {
                        console.error(`Failed to connect to local Redis at ${localRedisUrl}:`, error.message);
                    }
                } else {
                    console.error(`An unexpected error occurred while connecting to local Redis at ${localRedisUrl}:`, error);
                }
                throw new Error('Failed to connect to local Redis. Check your configuration and ensure Redis is running.');
            }
        }
        redisWrapper = new RedisWrapper(localRedisClient);
    } else {
        if (!redisConfig.upstashRedisRestUrl || !redisConfig.upstashRedisRestToken) {
            throw new Error('Upstash Redis configuration is missing. Please check your environment variables.');
        }
        try {
            redisWrapper = new RedisWrapper(new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$upstash$2f$redis$2f$nodejs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["Redis"]({
                url: redisConfig.upstashRedisRestUrl,
                token: redisConfig.upstashRedisRestToken
            }));
        } catch (error) {
            if (error instanceof Error) {
                if (error.message.includes('unauthorized')) {
                    console.error('Failed to connect to Upstash Redis: Unauthorized. Check your Upstash Redis token.');
                } else if (error.message.includes('not found')) {
                    console.error('Failed to connect to Upstash Redis: URL not found. Check your Upstash Redis URL.');
                } else {
                    console.error('Failed to connect to Upstash Redis:', error.message);
                }
            } else {
                console.error('An unexpected error occurred while connecting to Upstash Redis:', error);
            }
            throw new Error('Failed to connect to Upstash Redis. Check your configuration and credentials.');
        }
    }
    return redisWrapper;
}
async function closeRedisConnection() {
    if (redisWrapper) {
        await redisWrapper.close();
        redisWrapper = null;
    }
    if (localRedisClient) {
        await localRedisClient.quit();
        localRedisClient = null;
    }
}
}}),
"[project]/lib/actions/chat.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ {"407436dbee0eac9c07425c0e5c664090d819e110b0":"getChats","407ca78c913fc4e9a4f5581ca810f4a422a4182689":"getSharedChat","40aa79a925157ba7e49c6f04f8f726a56bb40cbe98":"clearChats","60312532a1c56a65646f003f72b560b30dfd0d9f82":"shareChat","603666b7d10ff9c12a65a76705854c0cda11397f77":"getChat","60b67376a13fda0f582e9a1ab02e67e578d29cf1da":"saveChat"} */ __turbopack_context__.s({
    "clearChats": (()=>clearChats),
    "getChat": (()=>getChat),
    "getChats": (()=>getChats),
    "getSharedChat": (()=>getSharedChat),
    "saveChat": (()=>saveChat),
    "shareChat": (()=>shareChat)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/cache.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/next/dist/api/navigation.react-server.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/components/navigation.react-server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$redis$2f$config$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/redis/config.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-route] (ecmascript)");
;
;
;
;
;
async function getRedis() {
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$redis$2f$config$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getRedisClient"])();
}
const CHAT_VERSION = 'v2';
function getUserChatKey(userId) {
    return `user:${CHAT_VERSION}:chat:${userId}`;
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getChats(userId) {
    if (!userId) {
        return [];
    }
    try {
        const redis = await getRedis();
        const chats = await redis.zrange(getUserChatKey(userId), 0, -1, {
            rev: true
        });
        if (chats.length === 0) {
            return [];
        }
        const results = await Promise.all(chats.map(async (chatKey)=>{
            const chat = await redis.hgetall(chatKey);
            return chat;
        }));
        return results.filter((result)=>{
            if (result === null || Object.keys(result).length === 0) {
                return false;
            }
            return true;
        }).map((chat)=>{
            const plainChat = {
                ...chat
            };
            if (typeof plainChat.messages === 'string') {
                try {
                    plainChat.messages = JSON.parse(plainChat.messages);
                } catch (error) {
                    plainChat.messages = [];
                }
            }
            if (plainChat.createdAt && !(plainChat.createdAt instanceof Date)) {
                plainChat.createdAt = new Date(plainChat.createdAt);
            }
            return plainChat;
        });
    } catch (error) {
        return [];
    }
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getChat(id, userId = 'anonymous') {
    const redis = await getRedis();
    const chat = await redis.hgetall(`chat:${id}`);
    if (!chat) {
        return null;
    }
    // Parse the messages if they're stored as a string
    if (typeof chat.messages === 'string') {
        try {
            chat.messages = JSON.parse(chat.messages);
        } catch (error) {
            chat.messages = [];
        }
    }
    // Ensure messages is always an array
    if (!Array.isArray(chat.messages)) {
        chat.messages = [];
    }
    return chat;
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ clearChats(userId = 'anonymous') {
    const redis = await getRedis();
    const userChatKey = getUserChatKey(userId);
    const chats = await redis.zrange(userChatKey, 0, -1);
    if (!chats.length) {
        return {
            error: 'No chats to clear'
        };
    }
    const pipeline = redis.pipeline();
    for (const chat of chats){
        pipeline.del(chat);
        pipeline.zrem(userChatKey, chat);
    }
    await pipeline.exec();
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["revalidatePath"])('/');
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["redirect"])('/');
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ saveChat(chat, userId = 'anonymous') {
    try {
        const redis = await getRedis();
        const pipeline = redis.pipeline();
        const chatToSave = {
            ...chat,
            messages: JSON.stringify(chat.messages)
        };
        pipeline.hmset(`chat:${chat.id}`, chatToSave);
        pipeline.zadd(getUserChatKey(userId), Date.now(), `chat:${chat.id}`);
        const results = await pipeline.exec();
        return results;
    } catch (error) {
        throw error;
    }
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getSharedChat(id) {
    const redis = await getRedis();
    const chat = await redis.hgetall(`chat:${id}`);
    if (!chat || !chat.sharePath) {
        return null;
    }
    return chat;
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ shareChat(id, userId = 'anonymous') {
    const redis = await getRedis();
    const chat = await redis.hgetall(`chat:${id}`);
    if (!chat || chat.userId !== userId) {
        return null;
    }
    const payload = {
        ...chat,
        sharePath: `/share/${id}`
    };
    await redis.hmset(`chat:${id}`, payload);
    return payload;
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    getChats,
    getChat,
    clearChats,
    saveChat,
    getSharedChat,
    shareChat
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getChats, "407436dbee0eac9c07425c0e5c664090d819e110b0", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getChat, "603666b7d10ff9c12a65a76705854c0cda11397f77", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(clearChats, "40aa79a925157ba7e49c6f04f8f726a56bb40cbe98", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(saveChat, "60b67376a13fda0f582e9a1ab02e67e578d29cf1da", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getSharedChat, "407ca78c913fc4e9a4f5581ca810f4a422a4182689", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(shareChat, "60312532a1c56a65646f003f72b560b30dfd0d9f82", null);
}}),
"[project]/lib/schema/related.tsx [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "relatedSchema": (()=>relatedSchema)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
;
const relatedSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].object({
    items: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].object({
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string()
    })).length(3)
});
}}),
"[project]/lib/agents/generate-related-questions.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "generateRelatedQuestions": (()=>generateRelatedQuestions)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$related$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/schema/related.tsx [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
;
;
;
async function generateRelatedQuestions(messages, model) {
    const lastMessages = messages.slice(-1).map((message)=>({
            ...message,
            role: 'user'
        }));
    const supportedModel = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isToolCallSupported"])(model);
    const currentModel = supportedModel ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getModel"])(model) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getToolCallModel"])(model);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["generateObject"])({
        model: currentModel,
        system: `As a professional web researcher, your task is to generate a set of three queries that explore the subject matter more deeply, building upon the initial query and the information uncovered in its search results.

    For instance, if the original query was "Starship's third test flight key milestones", your output should follow this format:

    Aim to create queries that progressively delve into more specific aspects, implications, or adjacent topics related to the initial query. The goal is to anticipate the user's potential information needs and guide them towards a more comprehensive understanding of the subject matter.
    Please match the language of the response to the user's language.`,
        messages: lastMessages,
        schema: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$related$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["relatedSchema"]
    });
    return result;
}
}}),
"[project]/lib/utils/index.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "cn": (()=>cn),
    "convertToExtendedCoreMessages": (()=>convertToExtendedCoreMessages),
    "convertToUIMessages": (()=>convertToUIMessages),
    "createModelId": (()=>createModelId),
    "getDefaultModelId": (()=>getDefaultModelId),
    "sanitizeUrl": (()=>sanitizeUrl),
    "transformToolMessages": (()=>transformToolMessages)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$node_modules$2f40$ai$2d$sdk$2f$provider$2d$utils$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/ai/node_modules/@ai-sdk/provider-utils/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$clsx$2f$dist$2f$clsx$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/clsx/dist/clsx.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tailwind$2d$merge$2f$dist$2f$bundle$2d$mjs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/tailwind-merge/dist/bundle-mjs.mjs [app-route] (ecmascript)");
;
;
;
function cn(...inputs) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tailwind$2d$merge$2f$dist$2f$bundle$2d$mjs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["twMerge"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$clsx$2f$dist$2f$clsx$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["clsx"])(inputs));
}
function transformToolMessages(messages) {
    return messages.map((message)=>message.role === 'tool' ? {
            ...message,
            role: 'assistant',
            content: JSON.stringify(message.content),
            type: 'tool'
        } : message);
}
function sanitizeUrl(url) {
    return url.replace(/\s+/g, '%20');
}
function createModelId(model) {
    return `${model.providerId}:${model.id}`;
}
function getDefaultModelId(models) {
    if (!models.length) {
        throw new Error('No models available');
    }
    return createModelId(models[0]);
}
function addToolMessageToChat({ toolMessage, messages }) {
    return messages.map((message)=>{
        if (message.toolInvocations) {
            return {
                ...message,
                toolInvocations: message.toolInvocations.map((toolInvocation)=>{
                    const toolResult = toolMessage.content.find((tool)=>tool.toolCallId === toolInvocation.toolCallId);
                    if (toolResult) {
                        return {
                            ...toolInvocation,
                            state: 'result',
                            result: toolResult.result
                        };
                    }
                    return toolInvocation;
                })
            };
        }
        return message;
    });
}
function convertToUIMessages(messages) {
    let pendingAnnotations = [];
    let pendingReasoning = undefined;
    let pendingReasoningTime = undefined;
    return messages.reduce((chatMessages, message)=>{
        // Handle tool messages
        if (message.role === 'tool') {
            return addToolMessageToChat({
                toolMessage: message,
                messages: chatMessages
            });
        }
        // Data messages are used to capture annotations, including reasoning.
        if (message.role === 'data') {
            if (message.content !== null && message.content !== undefined && typeof message.content !== 'string') {
                const content = message.content;
                if (content && typeof content === 'object' && 'type' in content && 'data' in content) {
                    if (content.type === 'reasoning') {
                        // If content.data is an object, capture its reasoning and time;
                        // otherwise treat it as a simple string.
                        if (typeof content.data === 'object' && content.data !== null) {
                            pendingReasoning = content.data.reasoning;
                            pendingReasoningTime = content.data.time;
                        } else {
                            pendingReasoning = content.data;
                            pendingReasoningTime = 0;
                        }
                    } else {
                        pendingAnnotations.push(content);
                    }
                }
            }
            return chatMessages;
        }
        // Build the text content and tool invocations from message.content.
        let textContent = '';
        let toolInvocations = [];
        if (message.content) {
            if (typeof message.content === 'string') {
                textContent = message.content;
            } else if (Array.isArray(message.content)) {
                for (const content of message.content){
                    if (content && typeof content === 'object' && 'type' in content) {
                        if (content.type === 'text' && 'text' in content) {
                            textContent += content.text;
                        } else if (content.type === 'tool-call' && 'toolCallId' in content && 'toolName' in content && 'args' in content) {
                            toolInvocations.push({
                                state: 'call',
                                toolCallId: content.toolCallId,
                                toolName: content.toolName,
                                args: content.args
                            });
                        }
                    }
                }
            }
        }
        // For assistant messages, assemble annotations from any stashed data.
        let annotations = undefined;
        if (message.role === 'assistant') {
            if (pendingAnnotations.length > 0 || pendingReasoning !== undefined) {
                annotations = [
                    ...pendingAnnotations,
                    ...pendingReasoning !== undefined ? [
                        {
                            type: 'reasoning',
                            data: {
                                reasoning: pendingReasoning,
                                time: pendingReasoningTime ?? 0
                            }
                        }
                    ] : []
                ];
            }
        }
        // Create the new message. Note: we do not include a top-level "reasoning" property.
        const newMessage = {
            id: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$node_modules$2f40$ai$2d$sdk$2f$provider$2d$utils$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"])(),
            role: message.role,
            content: textContent,
            toolInvocations: toolInvocations.length > 0 ? toolInvocations : undefined,
            annotations: annotations
        };
        chatMessages.push(newMessage);
        // Clear pending state after processing an assistant message.
        if (message.role === 'assistant') {
            pendingAnnotations = [];
            pendingReasoning = undefined;
            pendingReasoningTime = undefined;
        }
        return chatMessages;
    }, []);
}
function convertToExtendedCoreMessages(messages) {
    const result = [];
    for (const message of messages){
        // Convert annotations to data messages
        if (message.annotations && message.annotations.length > 0) {
            message.annotations.forEach((annotation)=>{
                result.push({
                    role: 'data',
                    content: annotation
                });
            });
        }
        // Convert reasoning to data message with unified structure (including time)
        if (message.reasoning) {
            const reasoningTime = message.reasoningTime ?? 0;
            const reasoningData = typeof message.reasoning === 'string' ? {
                reasoning: message.reasoning,
                time: reasoningTime
            } : {
                ...message.reasoning,
                time: message.reasoningTime ?? message.reasoning.time ?? 0
            };
            result.push({
                role: 'data',
                content: {
                    type: 'reasoning',
                    data: reasoningData
                }
            });
        }
        // Convert current message
        const converted = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["convertToCoreMessages"])([
            message
        ]);
        result.push(...converted);
    }
    return result;
}
}}),
"[project]/lib/streaming/handle-stream-finish.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "handleStreamFinish": (()=>handleStreamFinish)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$actions$2f$chat$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/actions/chat.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$generate$2d$related$2d$questions$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/agents/generate-related-questions.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/index.ts [app-route] (ecmascript)");
;
;
;
async function handleStreamFinish({ responseMessages, originalMessages, model, chatId, dataStream, skipRelatedQuestions = false, annotations = [] }) {
    try {
        const extendedCoreMessages = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["convertToExtendedCoreMessages"])(originalMessages);
        let allAnnotations = [
            ...annotations
        ];
        if (!skipRelatedQuestions) {
            // Notify related questions loading
            const relatedQuestionsAnnotation = {
                type: 'related-questions',
                data: {
                    items: []
                }
            };
            dataStream.writeMessageAnnotation(relatedQuestionsAnnotation);
            // Generate related questions
            const relatedQuestions = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$generate$2d$related$2d$questions$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateRelatedQuestions"])(responseMessages, model);
            // Create and add related questions annotation
            const updatedRelatedQuestionsAnnotation = {
                role: 'data',
                content: {
                    type: 'related-questions',
                    data: relatedQuestions.object
                }
            };
            dataStream.writeMessageAnnotation(updatedRelatedQuestionsAnnotation.content);
            allAnnotations.push(updatedRelatedQuestionsAnnotation);
        }
        // Create the message to save
        const generatedMessages = [
            ...extendedCoreMessages,
            ...responseMessages.slice(0, -1),
            ...allAnnotations,
            ...responseMessages.slice(-1)
        ];
        if (process.env.ENABLE_SAVE_CHAT_HISTORY !== 'true') {
            return;
        }
        // Get the chat from the database if it exists, otherwise create a new one
        const savedChat = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$actions$2f$chat$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getChat"])(chatId) ?? {
            messages: [],
            createdAt: new Date(),
            userId: 'anonymous',
            path: `/search/${chatId}`,
            title: originalMessages[0].content,
            id: chatId
        };
        // Save chat with complete response and related questions
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$actions$2f$chat$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["saveChat"])({
            ...savedChat,
            messages: generatedMessages
        }).catch((error)=>{
            console.error('Failed to save chat:', error);
            throw new Error('Failed to save chat history');
        });
    } catch (error) {
        console.error('Error in handleStreamFinish:', error);
        throw error;
    }
}
}}),
"[project]/lib/schema/search.tsx [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "searchSchema": (()=>searchSchema)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
;
const searchSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].object({
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string().describe('The query to search for'),
    max_results: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].number().describe('The maximum number of results to return. default is 20'),
    search_depth: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string().describe('The depth of the search. Allowed values are "basic" or "advanced"'),
    include_domains: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string()).describe('A list of domains to specifically include in the search results. Default is None, which includes all domains.'),
    exclude_domains: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string()).describe("A list of domains to specifically exclude from the search results. Default is None, which doesn't exclude any domains.")
});
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[project]/lib/tools/search.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "search": (()=>search),
    "searchTool": (()=>searchTool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/schema/search.tsx [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/index.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$exa$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/exa-js/dist/index.mjs [app-route] (ecmascript)");
;
;
;
;
const searchTool = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["tool"])({
    description: 'Search the web for information',
    parameters: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["searchSchema"],
    execute: async ({ query, max_results, search_depth, include_domains, exclude_domains })=>{
        // Tavily API requires a minimum of 5 characters in the query
        const filledQuery = query.length < 5 ? query + ' '.repeat(5 - query.length) : query;
        let searchResult;
        const searchAPI = process.env.SEARCH_API || 'tavily';
        const effectiveSearchDepth = searchAPI === 'searxng' && process.env.SEARXNG_DEFAULT_DEPTH === 'advanced' ? 'advanced' : search_depth || 'basic';
        console.log(`Using search API: ${searchAPI}, Search Depth: ${effectiveSearchDepth}`);
        try {
            if (searchAPI === 'searxng' && effectiveSearchDepth === 'advanced') {
                // API route for advanced SearXNG search
                const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';
                const response = await fetch(`${baseUrl}/api/advanced-search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: filledQuery,
                        maxResults: max_results,
                        searchDepth: effectiveSearchDepth,
                        includeDomains: include_domains,
                        excludeDomains: exclude_domains
                    })
                });
                if (!response.ok) {
                    throw new Error(`Advanced search API error: ${response.status} ${response.statusText}`);
                }
                searchResult = await response.json();
            } else {
                searchResult = await (searchAPI === 'tavily' ? tavilySearch : searchAPI === 'exa' ? exaSearch : searxngSearch)(filledQuery, max_results, effectiveSearchDepth === 'advanced' ? 'advanced' : 'basic', include_domains, exclude_domains);
            }
        } catch (error) {
            console.error('Search API error:', error);
            searchResult = {
                results: [],
                query: filledQuery,
                images: [],
                number_of_results: 0
            };
        }
        console.log('completed search');
        return searchResult;
    }
});
async function search(query, maxResults = 10, searchDepth = 'basic', includeDomains = [], excludeDomains = []) {
    return searchTool.execute({
        query,
        max_results: maxResults,
        search_depth: searchDepth,
        include_domains: includeDomains,
        exclude_domains: excludeDomains
    }, {
        toolCallId: 'search',
        messages: []
    });
}
async function tavilySearch(query, maxResults = 10, searchDepth = 'basic', includeDomains = [], excludeDomains = []) {
    const apiKey = process.env.TAVILY_API_KEY;
    if (!apiKey) {
        throw new Error('TAVILY_API_KEY is not set in the environment variables');
    }
    const includeImageDescriptions = true;
    const response = await fetch('https://api.tavily.com/search', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            api_key: apiKey,
            query,
            max_results: Math.max(maxResults, 5),
            search_depth: searchDepth,
            include_images: true,
            include_image_descriptions: includeImageDescriptions,
            include_answers: true,
            include_domains: includeDomains,
            exclude_domains: excludeDomains
        })
    });
    if (!response.ok) {
        throw new Error(`Tavily API error: ${response.status} ${response.statusText}`);
    }
    const data = await response.json();
    const processedImages = ("TURBOPACK compile-time truthy", 1) ? data.images.map(({ url, description })=>({
            url: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sanitizeUrl"])(url),
            description
        })).filter((image)=>typeof image === 'object' && image.description !== undefined && image.description !== '') : ("TURBOPACK unreachable", undefined);
    return {
        ...data,
        images: processedImages
    };
}
async function exaSearch(query, maxResults = 10, _searchDepth, includeDomains = [], excludeDomains = []) {
    const apiKey = process.env.EXA_API_KEY;
    if (!apiKey) {
        throw new Error('EXA_API_KEY is not set in the environment variables');
    }
    const exa = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$exa$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"](apiKey);
    const exaResults = await exa.searchAndContents(query, {
        highlights: true,
        numResults: maxResults,
        includeDomains,
        excludeDomains
    });
    return {
        results: exaResults.results.map((result)=>({
                title: result.title,
                url: result.url,
                content: result.highlight || result.text
            })),
        query,
        images: [],
        number_of_results: exaResults.results.length
    };
}
async function searxngSearch(query, maxResults = 10, searchDepth, includeDomains = [], excludeDomains = []) {
    const apiUrl = process.env.SEARXNG_API_URL;
    if (!apiUrl) {
        throw new Error('SEARXNG_API_URL is not set in the environment variables');
    }
    try {
        // Construct the URL with query parameters
        const url = new URL(`${apiUrl}/search`);
        url.searchParams.append('q', query);
        url.searchParams.append('format', 'json');
        url.searchParams.append('categories', 'general,images');
        // Apply search depth settings
        if (searchDepth === 'advanced') {
            url.searchParams.append('time_range', '');
            url.searchParams.append('safesearch', '0');
            url.searchParams.append('engines', 'google,bing,duckduckgo,wikipedia');
        } else {
            url.searchParams.append('time_range', 'year');
            url.searchParams.append('safesearch', '1');
            url.searchParams.append('engines', 'google,bing');
        }
        // Fetch results from SearXNG
        const response = await fetch(url.toString(), {
            method: 'GET',
            headers: {
                Accept: 'application/json'
            }
        });
        if (!response.ok) {
            const errorText = await response.text();
            console.error(`SearXNG API error (${response.status}):`, errorText);
            throw new Error(`SearXNG API error: ${response.status} ${response.statusText} - ${errorText}`);
        }
        const data = await response.json();
        // Separate general results and image results, and limit to maxResults
        const generalResults = data.results.filter((result)=>!result.img_src).slice(0, maxResults);
        const imageResults = data.results.filter((result)=>result.img_src).slice(0, maxResults);
        // Format the results to match the expected SearchResults structure
        return {
            results: generalResults.map((result)=>({
                    title: result.title,
                    url: result.url,
                    content: result.content
                })),
            query: data.query,
            images: imageResults.map((result)=>{
                const imgSrc = result.img_src || '';
                return imgSrc.startsWith('http') ? imgSrc : `${apiUrl}${imgSrc}`;
            }).filter(Boolean),
            number_of_results: data.number_of_results
        };
    } catch (error) {
        console.error('SearXNG API error:', error);
        throw error;
    }
}
}}),
"[project]/lib/streaming/parse-tool-call.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "parseToolCallXml": (()=>parseToolCallXml)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
;
function getTagContent(xml, tag) {
    const match = xml.match(new RegExp(`<${tag}>(.*?)</${tag}>`, 's'));
    return match ? match[1].trim() : '';
}
function parseToolCallXml(xml, schema) {
    const toolCallContent = getTagContent(xml, 'tool_call');
    if (!toolCallContent) {
        console.warn('No tool_call tag found in response');
        return {
            tool: ''
        };
    }
    const tool = getTagContent(toolCallContent, 'tool');
    if (!tool) return {
        tool: ''
    };
    const parametersXml = getTagContent(toolCallContent, 'parameters');
    if (!parametersXml || !schema) return {
        tool
    };
    try {
        // Extract all parameter values using tag names from schema
        const rawParameters = {};
        if (schema instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].ZodObject) {
            Object.keys(schema.shape).forEach((key)=>{
                const value = getTagContent(parametersXml, key);
                if (value) rawParameters[key] = value;
            });
        }
        // Parse parameters using the provided schema
        const parameters = schema.parse({
            ...rawParameters,
            // Convert comma-separated strings to arrays for array fields with default empty arrays
            include_domains: rawParameters.include_domains?.split(',').map((d)=>d.trim()).filter(Boolean) ?? [],
            exclude_domains: rawParameters.exclude_domains?.split(',').map((d)=>d.trim()).filter(Boolean) ?? [],
            // Convert string to number for numeric fields
            max_results: rawParameters.max_results ? parseInt(rawParameters.max_results, 10) : undefined
        });
        return {
            tool,
            parameters
        };
    } catch (error) {
        console.error('Failed to parse parameters:', error);
        return {
            tool
        };
    }
}
}}),
"[project]/lib/streaming/tool-execution.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "executeToolCall": (()=>executeToolCall)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$node_modules$2f40$ai$2d$sdk$2f$provider$2d$utils$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/ai/node_modules/@ai-sdk/provider-utils/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/schema/search.tsx [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tools/search.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$parse$2d$tool$2d$call$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/parse-tool-call.ts [app-route] (ecmascript)");
;
;
;
;
;
;
async function executeToolCall(coreMessages, dataStream, model, searchMode) {
    // If search mode is disabled, return empty tool call
    if (!searchMode) {
        return {
            toolCallDataAnnotation: null,
            toolCallMessages: []
        };
    }
    // Convert Zod schema to string representation
    const searchSchemaString = Object.entries(__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["searchSchema"].shape).map(([key, value])=>{
        const description = value.description;
        const isOptional = value instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].ZodOptional;
        return `- ${key}${isOptional ? ' (optional)' : ''}: ${description}`;
    }).join('\n');
    const defaultMaxResults = model?.includes('ollama') ? 5 : 20;
    // Generate tool selection using XML format
    const toolSelectionResponse = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["generateText"])({
        model: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getModel"])(model),
        system: `You are an intelligent assistant that analyzes conversations to select the most appropriate tools and their parameters.
            You excel at understanding context to determine when and how to use available tools, including crafting effective search queries.
            Current date: ${new Date().toISOString().split('T')[0]}

            Do not include any other text in your response.
            Respond in XML format with the following structure:
            <tool_call>
              <tool>tool_name</tool>
              <parameters>
                <query>search query text</query>
                <max_results>number - ${defaultMaxResults} by default</max_results>
                <search_depth>basic or advanced</search_depth>
                <include_domains>domain1,domain2</include_domains>
                <exclude_domains>domain1,domain2</exclude_domains>
              </parameters>
            </tool_call>

            Available tools: search

            Search parameters:
            ${searchSchemaString}

            If you don't need a tool, respond with <tool_call><tool></tool></tool_call>`,
        messages: coreMessages
    });
    // Parse the tool selection XML using the search schema
    const toolCall = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$parse$2d$tool$2d$call$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseToolCallXml"])(toolSelectionResponse.text, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["searchSchema"]);
    if (!toolCall || toolCall.tool === '') {
        return {
            toolCallDataAnnotation: null,
            toolCallMessages: []
        };
    }
    const toolCallAnnotation = {
        type: 'tool_call',
        data: {
            state: 'call',
            toolCallId: `call_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$node_modules$2f40$ai$2d$sdk$2f$provider$2d$utils$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"])()}`,
            toolName: toolCall.tool,
            args: JSON.stringify(toolCall.parameters)
        }
    };
    dataStream.writeData(toolCallAnnotation);
    // Support for search tool only for now
    const searchResults = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["search"])(toolCall.parameters?.query ?? '', toolCall.parameters?.max_results, toolCall.parameters?.search_depth, toolCall.parameters?.include_domains ?? [], toolCall.parameters?.exclude_domains ?? []);
    const updatedToolCallAnnotation = {
        ...toolCallAnnotation,
        data: {
            ...toolCallAnnotation.data,
            result: JSON.stringify(searchResults),
            state: 'result'
        }
    };
    dataStream.writeMessageAnnotation(updatedToolCallAnnotation);
    const toolCallDataAnnotation = {
        role: 'data',
        content: {
            type: 'tool_call',
            data: updatedToolCallAnnotation.data
        }
    };
    const toolCallMessages = [
        {
            role: 'assistant',
            content: `Tool call result: ${JSON.stringify(searchResults)}`
        },
        {
            role: 'user',
            content: 'Now answer the user question.'
        }
    ];
    return {
        toolCallDataAnnotation,
        toolCallMessages
    };
}
}}),
"[project]/lib/streaming/create-manual-tool-stream.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "createManualToolStreamResponse": (()=>createManualToolStreamResponse)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$manual$2d$researcher$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/agents/manual-researcher.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/context-window.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$handle$2d$stream$2d$finish$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/handle-stream-finish.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$tool$2d$execution$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/tool-execution.ts [app-route] (ecmascript)");
;
;
;
;
;
function createManualToolStreamResponse(config) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createDataStreamResponse"])({
        execute: async (dataStream)=>{
            const { messages, model, chatId, searchMode } = config;
            const modelId = `${model.providerId}:${model.id}`;
            let toolCallModelId = model.toolCallModel ? `${model.providerId}:${model.toolCallModel}` : modelId;
            try {
                const coreMessages = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["convertToCoreMessages"])(messages);
                const truncatedMessages = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["truncateMessages"])(coreMessages, (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMaxAllowedTokens"])(model));
                const { toolCallDataAnnotation, toolCallMessages } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$tool$2d$execution$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeToolCall"])(truncatedMessages, dataStream, toolCallModelId, searchMode);
                const researcherConfig = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$manual$2d$researcher$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["manualResearcher"])({
                    messages: [
                        ...truncatedMessages,
                        ...toolCallMessages
                    ],
                    model: modelId,
                    isSearchEnabled: searchMode
                });
                // Variables to track the reasoning timing.
                let reasoningStartTime = null;
                let reasoningDuration = null;
                const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["streamText"])({
                    ...researcherConfig,
                    onFinish: async (result)=>{
                        const annotations = [
                            ...toolCallDataAnnotation ? [
                                toolCallDataAnnotation
                            ] : [],
                            {
                                role: 'data',
                                content: {
                                    type: 'reasoning',
                                    data: {
                                        time: reasoningDuration ?? 0,
                                        reasoning: result.reasoning
                                    }
                                }
                            }
                        ];
                        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$handle$2d$stream$2d$finish$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["handleStreamFinish"])({
                            responseMessages: result.response.messages,
                            originalMessages: messages,
                            model: modelId,
                            chatId,
                            dataStream,
                            skipRelatedQuestions: true,
                            annotations
                        });
                    },
                    onChunk (event) {
                        const chunkType = event.chunk?.type;
                        if (chunkType === 'reasoning') {
                            if (reasoningStartTime === null) {
                                reasoningStartTime = Date.now();
                            }
                        } else {
                            if (reasoningStartTime !== null) {
                                const elapsedTime = Date.now() - reasoningStartTime;
                                reasoningDuration = elapsedTime;
                                dataStream.writeMessageAnnotation({
                                    type: 'reasoning',
                                    data: {
                                        time: elapsedTime
                                    }
                                });
                                reasoningStartTime = null;
                            }
                        }
                    }
                });
                result.mergeIntoDataStream(dataStream, {
                    sendReasoning: true
                });
            } catch (error) {
                console.error('Stream execution error:', error);
            }
        },
        onError: (error)=>{
            console.error('Stream error:', error);
            return error instanceof Error ? error.message : String(error);
        }
    });
}
}}),
"[project]/lib/schema/retrieve.tsx [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "retrieveSchema": (()=>retrieveSchema)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
;
const retrieveSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].object({
    url: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string().describe('The url to retrieve')
});
}}),
"[project]/lib/tools/retrieve.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "retrieveTool": (()=>retrieveTool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$retrieve$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/schema/retrieve.tsx [app-route] (ecmascript)");
;
;
const CONTENT_CHARACTER_LIMIT = 10000;
async function fetchJinaReaderData(url) {
    try {
        const response = await fetch(`https://r.jina.ai/${url}`, {
            method: 'GET',
            headers: {
                Accept: 'application/json',
                'X-With-Generated-Alt': 'true'
            }
        });
        const json = await response.json();
        if (!json.data || json.data.length === 0) {
            return null;
        }
        const content = json.data.content.slice(0, CONTENT_CHARACTER_LIMIT);
        return {
            results: [
                {
                    title: json.data.title,
                    content,
                    url: json.data.url
                }
            ],
            query: '',
            images: []
        };
    } catch (error) {
        console.error('Jina Reader API error:', error);
        return null;
    }
}
async function fetchTavilyExtractData(url) {
    try {
        const apiKey = process.env.TAVILY_API_KEY;
        const response = await fetch('https://api.tavily.com/extract', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                api_key: apiKey,
                urls: [
                    url
                ]
            })
        });
        const json = await response.json();
        if (!json.results || json.results.length === 0) {
            return null;
        }
        const result = json.results[0];
        const content = result.raw_content.slice(0, CONTENT_CHARACTER_LIMIT);
        return {
            results: [
                {
                    title: content.slice(0, 100),
                    content,
                    url: result.url
                }
            ],
            query: '',
            images: []
        };
    } catch (error) {
        console.error('Tavily Extract API error:', error);
        return null;
    }
}
const retrieveTool = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["tool"])({
    description: 'Retrieve content from the web',
    parameters: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$retrieve$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["retrieveSchema"],
    execute: async ({ url })=>{
        let results;
        // Use Jina if the API key is set, otherwise use Tavily
        const useJina = process.env.JINA_API_KEY;
        if (useJina) {
            results = await fetchJinaReaderData(url);
        } else {
            results = await fetchTavilyExtractData(url);
        }
        if (!results) {
            return null;
        }
        return results;
    }
});
}}),
"[project]/lib/tools/video-search.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "videoSearchTool": (()=>videoSearchTool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/schema/search.tsx [app-route] (ecmascript)");
;
;
const videoSearchTool = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["tool"])({
    description: 'Search for videos from YouTube',
    parameters: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$schema$2f$search$2e$tsx__$5b$app$2d$route$5d$__$28$ecmascript$29$__["searchSchema"],
    execute: async ({ query })=>{
        try {
            const response = await fetch('https://google.serper.dev/videos', {
                method: 'POST',
                headers: {
                    'X-API-KEY': process.env.SERPER_API_KEY || '',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    q: query
                })
            });
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return await response.json();
        } catch (error) {
            console.error('Video Search API error:', error);
            return null;
        }
    }
});
}}),
"[project]/lib/agents/researcher.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "researcher": (()=>researcher)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$retrieve$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tools/retrieve.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tools/search.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$video$2d$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/tools/video-search.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
;
;
;
;
;
const SYSTEM_PROMPT = `
Instructions:

You are a helpful AI assistant with access to real-time web search, content retrieval, and video search capabilities.
When asked a question, you should:
1. Search for relevant information using the search tool when needed
2. Use the retrieve tool to get detailed content from specific URLs
3. Use the video search tool when looking for video content
4. Analyze all search results to provide accurate, up-to-date information
5. Always cite sources using the [number](url) format, matching the order of search results. If multiple sources are relevant, include all of them, and comma separate them. Only use information that has a URL available for citation.
6. If results are not relevant or helpful, rely on your general knowledge
7. Provide comprehensive and detailed responses based on search results, ensuring thorough coverage of the user's question
8. Use markdown to structure your responses. Use headings to break up the content into sections.
9. **Use the retrieve tool only with user-provided URLs.**

Citation Format:
[number](url)
`;
function researcher({ messages, model, searchMode }) {
    try {
        const currentDate = new Date().toLocaleString();
        return {
            model: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getModel"])(model),
            system: `${SYSTEM_PROMPT}\nCurrent date and time: ${currentDate}`,
            messages,
            tools: {
                search: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["searchTool"],
                retrieve: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$retrieve$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["retrieveTool"],
                videoSearch: __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$tools$2f$video$2d$search$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["videoSearchTool"]
            },
            experimental_activeTools: searchMode ? [
                'search',
                'retrieve',
                'videoSearch'
            ] : [],
            maxSteps: searchMode ? 5 : 1,
            experimental_transform: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["smoothStream"])({
                chunking: 'word'
            })
        };
    } catch (error) {
        console.error('Error in chatResearcher:', error);
        throw error;
    }
}
}}),
"[project]/lib/streaming/create-tool-calling-stream.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "createToolCallingStreamResponse": (()=>createToolCallingStreamResponse)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$researcher$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/agents/researcher.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/ai/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/context-window.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$handle$2d$stream$2d$finish$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/handle-stream-finish.ts [app-route] (ecmascript)");
;
;
;
;
;
function createToolCallingStreamResponse(config) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createDataStreamResponse"])({
        execute: async (dataStream)=>{
            const { messages, model, chatId, searchMode } = config;
            const modelId = `${model.providerId}:${model.id}`;
            try {
                const coreMessages = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["convertToCoreMessages"])(messages);
                const truncatedMessages = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["truncateMessages"])(coreMessages, (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$context$2d$window$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMaxAllowedTokens"])(model));
                let researcherConfig = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$agents$2f$researcher$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["researcher"])({
                    messages: truncatedMessages,
                    model: modelId,
                    searchMode
                });
                const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["streamText"])({
                    ...researcherConfig,
                    onFinish: async (result)=>{
                        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$handle$2d$stream$2d$finish$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["handleStreamFinish"])({
                            responseMessages: result.response.messages,
                            originalMessages: messages,
                            model: modelId,
                            chatId,
                            dataStream,
                            skipRelatedQuestions: (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isReasoningModel"])(modelId)
                        });
                    }
                });
                result.mergeIntoDataStream(dataStream);
            } catch (error) {
                console.error('Stream execution error:', error);
                throw error;
            }
        },
        onError: (error)=>{
            console.error('Stream error:', error);
            return error instanceof Error ? error.message : String(error);
        }
    });
}
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[project]/app/api/chat/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "POST": (()=>POST),
    "maxDuration": (()=>maxDuration)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$create$2d$manual$2d$tool$2d$stream$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/create-manual-tool-stream.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$create$2d$tool$2d$calling$2d$stream$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/streaming/create-tool-calling-stream.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/utils/registry.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
;
;
;
;
const maxDuration = 30;
const DEFAULT_MODEL = {
    id: 'gpt-4o-mini',
    name: 'GPT-4o mini',
    provider: 'OpenAI',
    providerId: 'openai',
    enabled: true,
    toolCallType: 'native'
};
async function POST(req) {
    try {
        const { messages, id: chatId } = await req.json();
        const referer = req.headers.get('referer');
        const isSharePage = referer?.includes('/share/');
        if (isSharePage) {
            return new Response('Chat API is not available on share pages', {
                status: 403,
                statusText: 'Forbidden'
            });
        }
        const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
        const modelJson = cookieStore.get('selectedModel')?.value;
        const searchMode = cookieStore.get('search-mode')?.value === 'true';
        let selectedModel = DEFAULT_MODEL;
        if (modelJson) {
            try {
                selectedModel = JSON.parse(modelJson);
            } catch (e) {
                console.error('Failed to parse selected model:', e);
            }
        }
        if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$utils$2f$registry$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isProviderEnabled"])(selectedModel.providerId) || selectedModel.enabled === false) {
            return new Response(`Selected provider is not enabled ${selectedModel.providerId}`, {
                status: 404,
                statusText: 'Not Found'
            });
        }
        const supportsToolCalling = selectedModel.toolCallType === 'native';
        return supportsToolCalling ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$create$2d$tool$2d$calling$2d$stream$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createToolCallingStreamResponse"])({
            messages,
            model: selectedModel,
            chatId,
            searchMode
        }) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$streaming$2f$create$2d$manual$2d$tool$2d$stream$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createManualToolStreamResponse"])({
            messages,
            model: selectedModel,
            chatId,
            searchMode
        });
    } catch (error) {
        console.error('API route error:', error);
        return new Response('Error processing your request', {
            status: 500,
            statusText: 'Internal Server Error'
        });
    }
}
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__fdf8cc53._.js.map